/* uber-moives-app 1.0.0 */
"use strict";var maphtmlpage;window.initialize=function(){var a=document.getElementById("map-canvas");maphtmlpage=new window.MapService(window.google,a);var b=document.createElement("div");b.id="top",b.className="top",new window.SearchControl(b),maphtmlpage.addView(b,"TOP_LEFT");var c=document.createElement("div");c.id="bottom_panel",c.className="bottom_panel",new window.HomeControl(c),maphtmlpage.addView(c,"BOTTOM_CENTER")},window.HomeControl=function(a){var b=document.createElement("div");b.innerHTML=window.templates.home(),b.id="dashboard",b.className="dashboard",a.appendChild(b)},window.showLocation=function(a,b){return function(){window.map.zoomView(b.lat(),b.lng());var a=document.getElementById("location_detail");a||(a=document.createElement("div"),document.getElementById("bottom_panel").appendChild(a)),a.id="location_detail",a.className="location_detail",a.style.display="",a.innerHTML=window.templates.location(b);var c=document.createElement("input");c.type="button",c.value="Satelite View",c.addEventListener("click",function(){"Satelite View"===this.value?(window.map.sateliteView(b.lat(),b.lng()),this.value="Back to Roadmap"):(window.map.roadmapView(b.lat(),b.lng()),this.value="Satelite View")}),a.appendChild(c);var d=document.createElement("input");d.type="button",d.value="Street View",d.addEventListener("click",function(){window.map.streetView(b.lat(),b.lng())}),a.appendChild(d);var e=document.createElement("input");e.type="button",e.value="Back to Film",e.addEventListener("click",function(){window.map.reset();var a=document.getElementById("location_detail");a&&(a.style.display="none");var b=document.getElementById("film_detail");b&&(b.style.display="")}),a.appendChild(e),document.getElementById("film_detail").style.display="none"}},window.MapService=function(a,b){var c=[],d=new a.maps.LatLng(37.7577,-122.4376),e={center:d,zoom:11,mapTypeControl:!1,streetViewControl:!1,streetViewControlOptions:{position:a.maps.ControlPosition.RIGHT_CENTER},overviewMapControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{position:a.maps.ControlPosition.RIGHT_CENTER}},f=new a.maps.Map(b,e),g=[];return{onload:function(b,c){a.maps.event.addDomListener(window,"load",c)},addView:function(b,c){g[c]?g[c].forEach(function(a){a.style.display="none"}):g[c]=[];var d=!0;g[c].forEach(function(a){a.id===b.id&&(d=!1)}),d?(g[c].push(b),f.controls[a.maps.ControlPosition[c]].push(b)):console.log(b),b.style.display=""},setOptions:function(a){f.setOptions(a)},zoomView:function(b,c){var d=new a.maps.LatLng(b,c);f.setCenter(d),f.setZoom(14)},roadmapView:function(b,c){var d=new a.maps.LatLng(b,c);f.setCenter(d),f.setZoom(14),f.setMapTypeId(a.maps.MapTypeId.ROADMAP)},sateliteView:function(b,c){var d=new a.maps.LatLng(b,c);f.setCenter(d),f.setZoom(20),f.setMapTypeId(a.maps.MapTypeId.SATELLITE),f.setTilt(45),f.setHeading(90)},streetView:function(a,b){var c=f.getStreetView();c.setPosition({lat:a,lng:b}),c.setVisible(!0)},clearMarkers:function(){c.forEach(function(a){a.setMap(null)}),c=[]},reset:function(){f.setZoom(11),f.setCenter(d),f.setMapTypeId(a.maps.MapTypeId.ROADMAP)},plotLocation:function(b,d,e){var g=new a.maps.LatLng(b,d),h=new a.maps.Marker({position:g,map:f,animation:a.maps.Animation.DROP});c.push(h),e&&a.maps.event.addListener(h,"click",e)}}};var plotLocations=function(a){var b=new XMLHttpRequest;b.onload=function(){for(var a=this.response,b=0;b<a.length;b++){var c=a[b].locations+", San Francisco, CA 94111, USA",d=window.google,e=new d.maps.Geocoder,f="";e.geocode({address:c},function(b,c){c===d.maps.GeocoderStatus.OK?(f=b[0].geometry.location,window.map.plotLocation(f.lat(),f.lng(),window.showLocation(a,f))):window.alert("Geocode for the following reason: "+c)})}},b.open("GET","https://data.sfgov.org/resource/wwmu-gmzc.json?title="+encodeURIComponent(a.title)+"&director="+encodeURIComponent(a.director)),b.responseType="json",b.send()},displayLoadingPanel=function(a){var b=document.getElementById("location_detail");b&&(b.style.display="none");var c=document.getElementById("dashboard");c&&(c.style.display="none");var d;document.getElementById("film_detail")?(d=document.getElementById("film_detail"),d.innerHTML=window.templates.loading(a),d.style.display=""):(d=document.createElement("div"),d.id="film_detail",d.className="film_detail",d.innerHTML=window.templates.loading(a),document.getElementById("bottom_panel").appendChild(d))},getMoveDetail=function(a,b){var c=new XMLHttpRequest;c.onload=function(){var a=this.response[0],b=window.templates.movie(a);document.getElementById("film_detail").innerHTML=b},c.open("GET","https://data.sfgov.org/resource/wwmu-gmzc.json?title="+encodeURIComponent(a)+"&director="+encodeURIComponent(b)),c.responseType="json",c.send()};window.showMovieDetail=function(a,b){displayLoadingPanel(a.title),getMoveDetail(a.title,a.director),plotLocations(a,b)},window.SearchControl=function(a){var b=function(a){window.map.clearMarkers(),window.map.setOptions({streetViewControl:!1,zoomControl:!0}),document.getElementById("films_results").innerHTML="",document.getElementById("q").value=a.title,window.showMovieDetail(a)},c=document.createElement("input");c.type="search",c.name="q",c.id="q",c.placeholder="Enter film title...",a.appendChild(c),jQuery(c).autocomplete({source:function(a,b){$.ajax({url:"https://data.sfgov.org/resource/wwmu-gmzc.json",dataType:"json",data:{title:a.term},beforeSend:function(){},success:function(a){b(a)}})},select:function(a,c){a.preventDefault(),this.value=c.item.title,$(this).next().val(c.item.title),b(c.item)}}).data("ui-autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+b.title+" {"+b.locations+"}</a>").appendTo(a)};var d=document.createElement("div");d.id="films_results",a.appendChild(d)};var templates={};templates.mapCanvas=function(){return document.getElementById("map-canvas")},templates.home=function(){var a=[];return a.push("<h2>Movie Detail</h2>"),a.push("<div>Search movie locations in San Fransisco."),a.push("</div>"),a.join("")},templates.loading=function(a){var b=[];return b.push("<h2>"),b.push(a),b.push("</h2><br><em>Loading location</em>"),b.join("")},templates.movie=function(a){var b=[];return b.push('<div class="movie_detail">'),b.push("<h2>Movie Name : "),b.push(a.title),b.push("</h2>"),b.push("<b> Release Year :  </b>",a.release_year),b.push("<br><br>"),b.push("<b> Director:  </b>"),b.push("<em>"),b.push(a.director),b.push("</em><br><br>"),b.push("<b>Cast: </b>"),b.push(a.actor_1),b.push(", "),b.push(a.actor_2),b.push(", "),b.push(a.actor_3),b.push("<br><br>"),b.push("<b>Writer: </b>"),b.push(a.writer),b.push("<br><br></div>"),b.join("")},templates.location=function(a){var b=[];return b.push("<h2>"),b.push(a.location),b.push("</h2>"),b.push('<img src="https://maps.googleapis.com/maps/api/streetview?size=120x120&location='),b.push(a.lat()),b.push(","),b.push(a.lng()),b.push('" align="right">'),b.join("")};